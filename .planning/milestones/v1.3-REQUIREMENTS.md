# Requirements Archive: v1.3 Claude Code 通信协议

**Archived:** 2026-02-02
**Status:** ✅ SHIPPED

This is the archived requirements specification for v1.3.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: AI Swarm v1.3 Claude Code 通信协议

**Defined:** 2026-02-01
**Core Value:** 多 Agent 并行推进，Master 协调去重，减少人作为瓶颈

## v1.3 Requirements (Complete)

### 脚本工具

- [x] **SCRIPT-01**: `claude_comm.sh` — tmux send-keys / capture-pane 封装脚本
- [x] **SCRIPT-02**: `claude_poll.sh` — 轮询脚本，定期扫描各窗口状态
- [x] **SCRIPT-03**: `claude_status.sh` — 快速检查各窗口状态

### 消息格式

- [x] **COMM-01**: 标记词定义 — `[TASK]`, `[DONE]`, `[ERROR]`, `[WAIT]`, `[ACK]`
- [x] **COMM-02**: 任务消息格式 — `[TASK] {task_id}\n{description}` (单行实现)
- [x] **COMM-03**: 状态消息格式 — `[DONE|ERROR|WAIT|HELP] {task_id}`

### 脚本功能

- [x] **SEND-01**: `send <window> <task_id> "<description>"` — 发送任务到指定窗口
- [x] **SEND-02**: 发送前插入 `[TASK]` 标记行 (单行实现)
- [x] **POLL-01**: `poll <window> [--timeout N]` — 捕获窗口输出，解析状态标记
- [x] **POLL-02**: 识别 `[DONE]`, `[ERROR]`, `[WAIT]`, `[HELP]`, `[ACK]`
- [x] **POLL-03**: 超时参数支持 (默认 30 秒)

### 验收测试

- [x] **TEST-01**: 手动验收 — 发送任务到 worker-0，验证返回 [ACK] + [DONE]
- [x] **TEST-02**: 错误场景 — 待后续版本验证
- [x] **TEST-03**: 并发测试 — 待后续版本验证

## v1.2 Requirements (Validated)

- [x] **TMUX-01**: tmux 窗口自动创建脚本
- [x] **TMUX-02**: 窗口布局配置
- [x] **TMUX-03**: 会话命名规范
- [x] **CLAI-01**: Worker 启动命令
- [x] **CLAI-02**: Master 启动配置
- [x] **CLAI-03**: 启动顺序控制
- [x] **TEST-01**: 窗口可见性验证
- [x] **TEST-02**: 启动脚本测试

## Out of Scope

| Feature | Reason |
|---------|--------|
| Python 通信模块 | v1.3 只做外部脚本，不改 core 代码 |
| Master 集成 | 不修改 swarm/master.py |
| Pipeline 模式 | 任务链式依赖，v1.4+ |
| P2P 对等模式 | Worker 间直接通信，v1.4+ |
| Web 状态面板 | 图形界面，超出 tmux 范围 |
| SSH 跨机扩展 | 分布式协作，未来版本 |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| SCRIPT-01 | Phase 11 | Complete |
| SCRIPT-02 | Phase 11 | Complete |
| SCRIPT-03 | Phase 11 | Complete |
| COMM-01 | Phase 11 | Complete |
| COMM-02 | Phase 11 | Complete |
| COMM-03 | Phase 11 | Complete |
| SEND-01 | Phase 11 | Complete |
| SEND-02 | Phase 11 | Complete |
| POLL-01 | Phase 11 | Complete |
| POLL-02 | Phase 11 | Complete |
| POLL-03 | Phase 11 | Complete |
| TEST-01 | Phase 11 | Complete |
| TEST-02 | Phase 11 | Deferred |
| TEST-03 | Phase 11 | Deferred |

---

## Milestone Summary

**Shipped:** 11 of 14 v1.3 requirements
**Deferred:** 2 (TEST-02, TEST-03 — error handling and concurrency)
**Adjusted:** None

---

*Archived: 2026-02-02 as part of v1.3 milestone completion*
