---
phase: 21-maintenance-docs
plan: 21-01
type: execute
wave: 1
depends_on: []
files_modified:
  - README.md
  - docs/MAINTENANCE.md
  - docs/SCRIPTS.md
  - CHANGELOG.md
autonomous: true
user_setup: []
---

<objective>
Create structured maintenance documentation that enables newcomers to maintain and recover the system without historical context.

Purpose: Complete the v1.6 documentation deliverables with maintainer-focused guides that are structured, searchable, and extensible.

Output: 4 files created/modified: README.md (updated navigation), docs/MAINTENANCE.md, docs/SCRIPTS.md, CHANGELOG.md
</objective>

<execution_context>
@/home/user/.claude/get-shit-done/workflows/execute-plan.md
@/home/user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/home/user/projects/AAA/swarm/.planning/STATE.md
@/home/user/projects/AAA/swarm/.planning/ROADMAP.md
@/home/user/projects/AAA/swarm/.planning/REQUIREMENTS.md

# Existing documentation
@/home/user/projects/AAA/swarm/README.md
@/home/user/projects/AAA/swarm/CONTRIBUTING.md

# Scripts to be documented (v1.6 state - Phase 19-20 completed)
@/home/user/projects/AAA/swarm/scripts/_config.sh
@/home/user/projects/AAA/swarm/scripts/_common.sh
@/home/user/projects/AAA/swarm/scripts/claude_comm.sh
@/home/user/projects/AAA/swarm/scripts/claude_poll.sh
@/home/user/projects/AAA/swarm/scripts/claude_status.sh
@/home/user/projects/AAA/swarm/scripts/claude_auto_rescue.sh
@/home/user/projects/AAA/swarm/scripts/swarm_lock.sh
@/home/user/projects/AAA/swarm/scripts/swarm_broadcast.sh
@/home/user/projects/AAA/swarm/scripts/swarm_task_wrap.sh
@/home/user/projects/AAA/swarm/scripts/swarm_selfcheck.sh

# Milestone history for changelog
@/home/user/projects/AAA/swarm/.planning/MILESTONES.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create docs/MAINTENANCE.md with recovery and troubleshooting guide</name>
  <files>docs/MAINTENANCE.md</files>
  <action>
Create `docs/MAINTENANCE.md` with the following sections:

1. **维护入口** (Maintenance Entry Points)
   - 快速检查: `swarm selfcheck`
   - 查看状态: `claude status` (使用 `claude_status.sh`)

2. **环境恢复** (Environment Recovery)
   - tmux 会话清理流程
   - 状态目录清理 (`/tmp/ai_swarm`)
   - 锁文件清理
   - 重建完整环境步骤

3. **故障排查** (Troubleshooting)
   - 常见问题列表
   - 诊断命令
   - 错误日志查看

4. **紧急流程** (Emergency Procedures)
   - **五步紧急恢复流程（按顺序执行）：**
     1. **备份 (Backup)** - 复制状态目录：`cp -r /tmp/ai_swarm /tmp/ai_swarm.backup.$(date +%Y%m%d%H%M%S)`
     2. **优雅停 (Graceful Stop)** - 发送 SIGTERM：`pkill -TERM -f "claude.*worker"`，等待 10 秒
     3. **强杀 (Force Kill)** - 发送 SIGKILL：`pkill -9 -f "claude.*worker"`，如果进程未停止
     4. **清锁 (Clear Locks)** - 移除所有锁文件：`rm -f /tmp/ai_swarm/locks/*`
     5. **复验 (Verify)** - 确认系统安全：`tmux ls` 和 `ls /tmp/ai_swarm/locks/`

5. **维护清单** (Maintenance Checklist)
   - [ ] tmux 清理：检查并关闭残留会话
   - [ ] 状态目录清理：清理 `locks/`、`status.log`
   - [ ] 重建流程：重新初始化环境
   - [ ] 脚本健康检查：验证所有脚本可执行
   - [ ] 配置验证：检查 _config.sh 和 _common.sh

6. **最佳实践** (Best Practices)
   - 定期维护建议
   - 常见操作规范

写作原则：
- 新人无需历史上下文即可操作
- 每个步骤都有具体命令
- 结构化、可搜索
- 预留扩展空间
</action>
  <verify>test -f docs/MAINTENANCE.md && grep -q "维护入口" docs/MAINTENANCE.md && grep -q "维护清单" docs/MAINTENANCE.md && grep -q "备份" docs/MAINTENANCE.md && grep -q "优雅停" docs/MAINTENANCE.md && grep -q "强杀" docs/MAINTENANCE.md && grep -q "清锁" docs/MAINTENANCE.md && grep -q "复验" docs/MAINTENANCE.md</verify>
  <done>docs/MAINTENANCE.md exists with maintenance entry points, environment recovery, troubleshooting, 5-step emergency procedures, and maintenance checklist sections</done>
</task>

<task type="auto">
  <name>Task 2: Create docs/SCRIPTS.md with complete script index</name>
  <files>docs/SCRIPTS.md</files>
  <action>
Create `docs/SCRIPTS.md` with a complete script index:

For each script, document:
1. **用途** (Purpose) - 一句话说明脚本功能
2. **参数** (Parameters) - 命令行参数列表和说明
3. **示例** (Examples) - 至少 2 个常用命令示例
4. **依赖** (Dependencies) - 依赖的其他脚本或配置

**主脚本列表（10 个核心脚本）：**

1. `_config.sh` - 统一配置入口（被 source，无执行参数）
2. `_common.sh` - 共享库（被 source，无执行参数）
3. `claude_comm.sh` - Claude CLI 通信命令
4. `claude_poll.sh` - 轮询窗口状态
5. `claude_status.sh` - 快速状态检查
6. `claude_auto_rescue.sh` - 自动确认脚本
7. `swarm_task_wrap.sh` - 任务生命周期包装器
8. `swarm_lock.sh` - 任务锁操作
9. `swarm_broadcast.sh` - 状态广播
10. `swarm_selfcheck.sh` - 系统健康检查

**独立实用脚本（1 个，由 v1.4 保留）：**

11. `swarm_status_log.sh` - 状态日志记录（独立运行，与 claude_status.sh 功能互补）

**注意：**
- `swarm_e2e_test.sh` 仅用于集成验证/测试用途，不作为日常运维脚本，因此不包含在此文档中
- 新脚本来自 Phase 19 (`swarm_task_wrap.sh`) 和 Phase 20 (`swarm_selfcheck.sh`)
- `swarm_status_log.sh` 是独立实用脚本，记录详细运行日志

格式模板：
```markdown
## script-name.sh

**用途：** 一句话描述

**参数：**
- `--option`：说明

**示例：**
```bash
./script-name.sh command args
```

**依赖：** `_common.sh`, `other-script.sh`
```

写作原则：
- 统一的格式模板
- 每个脚本可独立阅读
- 至少 2 个示例可直接复制使用
- 按功能分组组织
</action>
  <verify>test -f docs/SCRIPTS.md && grep -q "claude_comm.sh" docs/SCRIPTS.md && grep -q "swarm_task_wrap.sh" docs/SCRIPTS.md && grep -q "swarm_selfcheck.sh" docs/SCRIPTS.md && grep -q "swarm_status_log.sh" docs/SCRIPTS.md && test $(grep -c "```bash" docs/SCRIPTS.md) -ge 22</verify>
  <done>docs/SCRIPTS.md exists with complete script index for all 11 scripts (10 core + 1 utility), each with 2+ examples</done>
</task>

<task type="auto">
  <name>Task 3: Create CHANGELOG.md with v1.0-v1.6 history</name>
  <files>CHANGELOG.md</files>
  <action>
Create `CHANGELOG.md` with version history from v1.0 to v1.6:

For each version, document:
1. **发布日期** (Date)
2. **主要交付物** (Delivered) - 一句话总结
3. **分类变更** - 按 Features / Bug Fixes / Under the Hood 组织
4. **脚本数量** - 新增/修改的脚本

**版本结构：**
```markdown
# Changelog

## v1.6 (2026-02-XX) - 长期可维护性 + 流程闭环

**Delivered:** Phase 18 统一配置入口、Phase 20 自检

**Planned:** Phase 19 任务包装、Phase 21 维护文档

### Features
- 新增 _config.sh 统一配置管理 (Phase 18)
- 新增 swarm_task_wrap.sh 任务生命周期包装器 (Phase 19)
- 新增 swarm_selfcheck.sh 一键系统自检 (Phase 20)

### Under the Hood
- 新增 docs/MAINTENANCE.md 维护指南 (Phase 21)
- 新增 docs/SCRIPTS.md 脚本索引 (Phase 21)
- 新增 CHANGELOG.md 版本历史 (Phase 21)

## v1.5 (2026-02-02) - 状态广播闭环 + 自动救援 + 维护性改进

**Delivered:** _common.sh、claude_auto_rescue.sh、swarm_broadcast.sh

### Features
- 新增 claude_auto_rescue.sh 自动确认脚本
- 新增 swarm_broadcast.sh 状态广播

### Under the Hood
- 新增 _common.sh 统一配置和日志
- 更新 CONTRIBUTING.md

... (v1.4, v1.3, v1.2, v1.1, v1.0)
```

**来源：**
- v1.6: 当前计划和 STATE.md
- v1.0-v1.5: .planning/MILESTONES.md

**分类原则：**
- **Features**: 用户可见的新功能、命令、脚本
- **Bug Fixes**: 错误修复、问题解决
- **Under the Hood**: 内部改进、文档、基础设施

写作原则：
- 保持格式一致
- 突出关键变更
- 新人可快速了解版本演进
- 预留未来版本空间
</action>
  <verify>test -f CHANGELOG.md && grep -q "v1.6" CHANGELOG.md && grep -q "v1.0" CHANGELOG.md && grep -q "### Features" CHANGELOG.md && grep -q "### Bug Fixes" CHANGELOG.md && grep -q "### Under the Hood" CHANGELOG.md && grep -q "Planned" CHANGELOG.md</verify>
  <done>CHANGELOG.md exists with v1.0-v1.6 version history with Features/Bug Fixes/Under the Hood sections, and Planned/Delivered distinction for v1.6</done>
</task>

<task type="auto">
  <name>Task 4: Update README.md with navigation and command mapping</name>
  <files>README.md</files>
  <action>
Update `README.md` to provide clear navigation to documentation:

1. **精简现有内容（仅迁移维护相关，保留核心信息）**
   - **保留**：项目简介、快速启动、关键命令（如启动 Master/Worker）
   - **迁移到 docs/**：环境恢复、故障排查、紧急流程、维护清单等维护相关内容
   - **禁止删除**：项目核心说明和操作命令

2. **新增文档导航** - 在适当位置添加：
   ```markdown
   ## 维护指南

   完整维护文档见 [docs/MAINTENANCE.md](docs/MAINTENANCE.md)，包括：
   - 环境恢复流程
   - 故障排查指南
   - 紧急处理步骤（五步紧急恢复流程）
   - 维护清单

   ## 脚本索引

   所有脚本用法见 [docs/SCRIPTS.md](docs/SCRIPTS.md)

   ## 命令映射

   注意：`claude status` 属于 Claude CLI 命令，不是 swarm 命令；swarm 命令以 `swarm <verb>` 形式出现。

   Claude CLI 命令与脚本对应：

   | 命令 | 脚本文件 | 说明 |
   |------|----------|------|
   | `claude status` | `claude_status.sh` | 快速状态检查 |
   | `swarm task-wrap` | `swarm_task_wrap.sh` | 任务生命周期包装器 |
   | `swarm selfcheck` | `swarm_selfcheck.sh` | 系统健康检查 |
   | `swarm lock` | `swarm_lock.sh` | 任务锁操作 |
   | `swarm broadcast` | `swarm_broadcast.sh` | 状态广播 |
   | `swarm rescue` | `claude_auto_rescue.sh` | 自动确认脚本 |

   ## 变更记录

   版本历史见 [CHANGELOG.md](CHANGELOG.md)
   ```

3. **保持简洁** - 每个链接配一句话说明，不展开内容

4. **确保链接正确** - 验证所有相对路径链接有效
</action>
  <verify>grep -q "MAINTENANCE.md" README.md && grep -q "SCRIPTS.md" README.md && grep -q "CHANGELOG.md" README.md && grep -q "claude status" README.md && grep -q "claude_status.sh" README.md && grep -q "命令映射\|Command Mapping" README.md</verify>
  <done>README.md updated with clear navigation links and command-to-script mapping</done>
</task>

</tasks>

<verification>
## Documentation Verification

```bash
# 1. Check MAINTENANCE.md structure
test -f docs/MAINTENANCE.md
grep -q "环境恢复" docs/MAINTENANCE.md
grep -q "维护清单" docs/MAINTENANCE.md
grep -q "tmux" docs/MAINTENANCE.md
# Check 5-step emergency procedure
grep -q "备份" docs/MAINTENANCE.md
grep -q "优雅停" docs/MAINTENANCE.md
grep -q "强杀" docs/MAINTENANCE.md
grep -q "清锁" docs/MAINTENANCE.md
grep -q "复验" docs/MAINTENANCE.md

# 2. Check SCRIPTS.md structure
test -f docs/SCRIPTS.md
grep -q "claude_comm.sh" docs/SCRIPTS.md
grep -q "swarm_task_wrap.sh" docs/SCRIPTS.md
grep -q "swarm_selfcheck.sh" docs/SCRIPTS.md
grep -q "swarm_status_log.sh" docs/SCRIPTS.md
# Verify 2 examples per script (11 scripts x 2 code blocks minimum)
test $(grep -c "```bash" docs/SCRIPTS.md) -ge 22

# 3. Check CHANGELOG.md
test -f CHANGELOG.md
grep -q "v1.6" CHANGELOG.md
grep -q "v1.0" CHANGELOG.md
grep -q "### Features" CHANGELOG.md
grep -q "### Bug Fixes" CHANGELOG.md
grep -q "### Under the Hood" CHANGELOG.md
grep -q "Planned" CHANGELOG.md

# 4. Check README.md navigation
grep -q "MAINTENANCE.md" README.md
grep -q "SCRIPTS.md" README.md
grep -q "CHANGELOG.md" README.md
grep -q "claude status" README.md
grep -q "claude_status.sh" README.md

# 5. Integration verification
ls -la docs/MAINTENANCE.md docs/SCRIPTS.md CHANGELOG.md
```

</verification>

<success_criteria>
1. README.md provides clear navigation to maintenance/script/changelog docs
2. README.md contains correct command-to-script mapping (claude status -> claude_status.sh, not swarm_status.sh)
3. docs/MAINTENANCE.md contains 5-step emergency procedure (备份, 优雅停, 强杀, 清锁, 复验)
4. docs/MAINTENANCE.md contains environment recovery, troubleshooting, and maintenance checklist
5. docs/SCRIPTS.md contains complete script index with 11 scripts (10 core + swarm_status_log.sh utility)
6. docs/SCRIPTS.md contains at least 2 examples per script (22+ code blocks total)
7. CHANGELOG.md contains v1.0-v1.6 change summary with Features/Bug Fixes/Under the Hood sections
8. CHANGELOG.md correctly marks Phase 19/21 as "Planned" and Phase 18/20 as "Delivered"
9. All docs are structured, searchable, and extensible
10. Newcomers can complete maintenance/recovery without historical context
</success_criteria>

<output>
After completion, create `.planning/phases/21-maintenance-docs/21-01-SUMMARY.md`
</output>
