---
phase: 10-acceptance-testing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false
user_setup: []
must_haves:
  truths:
    - "swarm up creates tmux session with 4 windows (master + 3 workers)"
    - "swarm status --panes displays 4 window pane snapshots with status icons"
    - "Master detects 'Press Enter' patterns and auto-sends ENTER"
    - "swarm down cleanly terminates tmux session"
  artifacts: []
---

<objective>
Manual User Acceptance Testing with real tmux sessions to verify v1.1 core functionality.

**Purpose:** Verify the 4 critical paths work correctly in a real environment.
**Output:** UAT checklist with pass/fail status for each verification step.
</objective>

<context>
@/home/user/projects/AAA/swarm/.planning/STATE.md
@/home/user/projects/AAA/swarm/.planning/ROADMAP.md

## Phase 9 Output (CLI Status Enhancement)
- `swarm status --panes` displays master + worker-0/1/2 pane snapshots
- Status icons: [ERROR], [DONE], [ ]
- 20 lines per window, graceful tmux unavailability handling

## Phase 8 Output (Master tmux scan)
- Master auto-detects "Press Enter" patterns in tmux panes
- Sends ENTER automatically with 30s cooldown per window
- 3 second polling interval

## Testing Approach
This is a MANUAL test phase - no automated tests, just human verification with real tmux sessions.
</context>

<tasks>

<task type="manual">
  <name>UAT Step 1: Start fresh tmux session</name>
  <files></files>
  <action>
**Prerequisites:**
- Close any existing tmux sessions
- Ensure no running `swarm-*` sessions

**Test Steps:**
```bash
# 1. Kill any existing swarm-uat-test sessions only
tmux kill-session -t swarm-uat-test 2>/dev/null || true
sleep 1

# 2. Verify no tmux sessions (or only unrelated ones)
tmux list-sessions 2>&1 | grep -q "no server" && echo "✓ No tmux sessions" || echo "✓ Other sessions may exist (OK)"
```

**Expected Result:**
- No `swarm-uat-test` session running
- Other tmux sessions may exist (unchanged)
- Command returns success (exit 0)
  </action>
  <verify>
- [ ] No tmux sessions exist before test
</verify>
  <done>
Fresh tmux environment ready
</done>
</task>

<task type="manual">
  <name>UAT Step 2: swarm up - verify 4 window creation</name>
  <files></files>
  <action>
**Test Command:**
```bash
python3 -m swarm.cli up --cluster-id uat-test --workers 3
```

**Verify:**
1. Session `swarm-uat-test` created
2. 4 windows exist: master, worker-0, worker-1, worker-2
3. Command exits cleanly (return code 0)

**Commands to verify:**
```bash
# Check session exists
tmux has-session -t swarm-uat-test && echo "✓ Session exists"

# List windows (should show 4)
tmux list-windows -t swarm-uat-test
```
  </action>
  <verify>
- [ ] Session `swarm-uat-test` exists
- [ ] Master window exists
- [ ] worker-0, worker-1, worker-2 windows exist
- [ ] Command returns 0
</verify>
  <done>
4-window tmux session created successfully
</done>
</task>

<task type="manual">
  <name>UAT Step 3: swarm status (without --panes)</name>
  <files></files>
  <action>
**Test Command:**
```bash
python3 -m swarm.cli status --cluster-id uat-test
```

**Expected behavior:**
- Shows session info (no pane sections)
- Does NOT show `=== master ===` in output
- Returns exit code 0

**Verify:**
```bash
OUTPUT=$(python3 -m swarm.cli status --cluster-id uat-test)
echo "$OUTPUT" | grep -q "=== master" && echo "✗ FAIL: Should not have pane output" || echo "✓ PASS: No pane output"
```
  </action>
  <verify>
- [ ] Status shows session info
- [ ] No pane sections (no `=== master ===`)
- [ ] Command returns 0
</verify>
  <done>
swarm status without --panes works correctly
</done>
</task>

<task type="manual">
  <name>UAT Step 4: swarm status --panes - verify snapshot display</name>
  <files></files>
  <action>
**Test Command:**
```bash
python3 -m swarm.cli status --cluster-id uat-test --panes
```

**Expected output sections:**
```
=== master [ ] ===
(last 20 lines of pane content)

=== worker-0 [ ] ===
...

=== worker-1 [ ] ===
...

=== worker-2 [ ] ===
...
```

**Verify:**
```bash
OUTPUT=$(python3 -m swarm.cli status --cluster-id uat-test --panes)

# Check all windows present
echo "$OUTPUT" | grep -q "=== master" && echo "✓ master present" || echo "✗ FAIL"
echo "$OUTPUT" | grep -q "=== worker-0" && echo "✓ worker-0 present" || echo "✗ FAIL"
echo "$OUTPUT" | grep -q "=== worker-1" && echo "✓ worker-1 present" || echo "✗ FAIL"
echo "$OUTPUT" | grep -q "=== worker-2" && echo "✓ worker-2 present" || echo "✗ FAIL"

# Check status icons present (brackets)
echo "$OUTPUT" | grep -q "\[ \]" && echo "✓ Status icons present" || echo "✗ FAIL"
```
  </action>
  <verify>
- [ ] Pane sections displayed for master
- [ ] Pane sections displayed for worker-0, worker-1, worker-2
- [ ] Status icons ([ ], [ERROR], [DONE]) visible
- [ ] Command returns 0
</verify>
  <done>
swarm status --panes displays 4 window snapshots correctly
</done>
</task>

<task type="manual">
  <name>UAT Step 5: Test status icon detection (ERROR case)</name>
  <files></files>
  <action>
**Inject error content into master window:**

```bash
# Send error message to master window
tmux send-keys -t swarm-uat-test:master "Error: Connection failed" C-m
sleep 1

# Verify status shows [ERROR]
python3 -m swarm.cli status --cluster-id uat-test --panes | grep "master"
```

**Expected:**
- Master pane shows `[ERROR]` status icon
- Content contains "Error" keyword
  </action>
  <verify>
- [ ] `[ERROR]` icon appears for error content
- [ ] Error text visible in pane output
</verify>
  <done>
Status icon [ERROR] detection works
</done>
</task>

<task type="manual">
  <name>UAT Step 6: Test status icon detection (DONE case)</name>
  <files></files>
  <action>
**Inject done content into worker-0 window:**

```bash
# Send done message to worker-0 window
tmux send-keys -t swarm-uat-test:worker-0 "Task DONE successfully" C-m
sleep 1

# Verify status shows [DONE]
python3 -m swarm.cli status --cluster-id uat-test --panes | grep "worker-0"
```

**Expected:**
- worker-0 pane shows `[DONE]` status icon
- Content contains "DONE" keyword
  </action>
  <verify>
- [ ] `[DONE]` icon appears for done content
- [ ] Done text visible in pane output
</verify>
  <done>
Status icon [DONE] detection works
</done>
</task>

<task type="manual">
  <name>UAT Step 7: Master auto-ENTER verification</name>
  <files></files>
  <action>
**Goal:** Verify Master detects "Press Enter" and auto-sends ENTER.

**Prerequisite:** Master process must be running (started via `swarm up`).

**Test Procedure:**

1. **Verify Master is running:**
```bash
ps aux | grep "[p]ython3 -m swarm.cli.*master"
```
If no Master process → mark this step N/A and skip to Step 8.

2. **Inject "Press Enter" pattern into a worker window:**
```bash
# Send "Press Enter" prompt to worker-0
tmux send-keys -t swarm-uat-test:worker-0 "Please press Enter to continue" C-m
echo "✓ Injected 'Press Enter' pattern into worker-0"
```

3. **Wait for Master polling cycle (3 seconds max):**
```bash
sleep 5  # Wait for 2+ polling cycles
```

4. **Verify auto-ENTER was sent:**

   **Option A - Observe echo in window:**
```bash
# Check if worker-0 received the ENTER (should show new prompt line)
tmux capture-pane -t swarm-uat-test:worker-0 -p | tail -5
```

   **Option B - Check Master logs (if running with output):**
```bash
# Look for Auto-ENTER log message (if logging is enabled)
echo "Check Master window for 'Auto-ENTER' log message"
```

   **Option C - Verify pane content changed:**
```bash
# Capture pane again and check for new content
tmux capture-pane -t swarm-uat-test:worker-0 -p | tail -3
```

5. **If none of the above confirm ENTER was sent:**
```bash
echo "⚠ Unable to verify auto-ENTER - Master may be polling but output not visible"
echo "  Fallback: Unit test for WaitDetector passes (Step 7b)"
```

**Fallback - Verify via WaitDetector unit test:**
```bash
python3 -c "
from swarm.master import WaitDetector
d = WaitDetector()

# Test pattern detection
content = 'Please press Enter to continue...'
patterns = d.detect_in_pane(content)
print(f'Detected patterns: {patterns}')
assert len(patterns) > 0, 'Should detect press enter'
print('✓ WaitDetector detects Press Enter patterns')

# Verify case-insensitive
content_upper = 'PLEASE PRESS ENTER TO CONTINUE'
patterns_upper = d.detect_in_pane(content_upper)
assert len(patterns_upper) > 0, 'Should detect uppercase'
print('✓ Case-insensitive detection works')
"
```

**Expected Result:**
- Master detects pattern within 3s polling cycle
- ENTER is sent to worker-0 (observable or inferred)
- No crash/errors from Master
  </action>
  <verify>
- [ ] Master process is running (if not, mark N/A)
- [ ] "Press Enter" pattern injected into worker window
- [ ] WaitDetector correctly identifies pattern (unit test)
- [ ] Auto-ENTER behavior: Observed OR N/A (document reason)
</verify>
  <done>
Master auto-ENTER verified (or N/A with reason documented)
</done>
</task>

<task type="manual">
  <name>UAT Step 8: swarm down - verify clean termination</name>
  <files></files>
  <action>
**Test Command:**
```bash
python3 -m swarm.cli down --cluster-id uat-test
```

**Verify:**
```bash
# Session should no longer exist
tmux has-session -t swarm-uat-test 2>&1 | grep -q "no server" && echo "✓ Session terminated" || echo "✗ FAIL: Session still exists"

# Verify all windows are gone
tmux list-sessions 2>&1 | grep -q "no server" && echo "✓ All sessions cleaned up" || echo "✗ FAIL"
```

**Expected:**
- Command returns exit code 0
- No tmux sessions remain
- Clean termination
  </action>
  <verify>
- [ ] Command returns 0
- [ ] Session `swarm-uat-test` no longer exists
- [ ] No orphaned tmux processes
</verify>
  <done>
swarm down cleanly terminates tmux session
</done>
</task>

<task type="manual">
  <name>UAT Step 9: Final summary and cleanup</name>
  <files></files>
  <action>
**Review all test results:**

```bash
# Kill remaining uat-test session
tmux kill-session -t swarm-uat-test 2>/dev/null || true
sleep 1

echo "=========================================="
echo "UAT Complete - Phase 10 Summary"
echo "=========================================="
```

**Fill in the checklist:**

| Test Step | Status | Notes |
|-----------|--------|-------|
| 1. Fresh tmux session | ✅ / ❌ | |
| 2. swarm up (4 windows) | ✅ / ❌ | |
| 3. swarm status (no panes) | ✅ / ❌ | |
| 4. swarm status --panes | ✅ / ❌ | |
| 5. [ERROR] icon detection | ✅ / ❌ | |
| 6. [DONE] icon detection | ✅ / ❌ | |
| 7. Master auto-ENTER | ✅ / ❌ | |
| 8. swarm down | ✅ / ❌ | |

**Pass Criteria:** All 8 steps must pass for UAT to pass.
  </action>
  <verify>
- [ ] All 8 test steps completed
- [ ] Pass rate: 8/8 required
- [ ] Any failures documented
</verify>
  <done>
UAT complete with full summary
</done>
</task>

</tasks>

<verification>
## UAT Verification Checklist

1. **swarm up creates 4 windows**
   - [ ] Session `swarm-{cluster}` created
   - [ ] master window exists
   - [ ] worker-0, worker-1, worker-2 windows exist
   - [ ] Command returns 0

2. **swarm status (baseline)**
   - [ ] Shows session info
   - [ ] No pane sections
   - [ ] Command returns 0

3. **swarm status --panes**
   - [ ] Shows pane for master
   - [ ] Shows pane for worker-0, worker-1, worker-2
   - [ ] Status icons visible
   - [ ] Command returns 0

4. **Status icon [ERROR]**
   - [ ] Content with "Error" shows [ERROR] icon

5. **Status icon [DONE]**
   - [ ] Content with "DONE" shows [DONE] icon

6. **Master auto-ENTER**
   - [ ] WaitDetector detects "Press Enter" patterns
   - [ ] Detection is case-insensitive

7. **swarm down**
   - [ ] Command returns 0
   - [ ] Session terminated
   - [ ] No orphaned processes
</verification>

<success_criteria>
Phase 10 UAT passes when:
1. swarm up creates tmux session with master + 3 workers
2. swarm status displays session information correctly
3. swarm status --panes shows 4 window pane snapshots
4. Status icons ([ERROR], [DONE], [ ]) work correctly
5. Master auto-ENTER detection is functional
6. swarm down cleanly terminates all sessions

**Required:** 8/8 test steps pass
</success_criteria>

<output>
After completion, create `.planning/phases/10-acceptance-testing/10-01-SUMMARY.md` with:
- UAT results for each test step
- Pass/fail status for each verification
- Any issues encountered
- Overall UAT pass/fail decision
</output>
