---
phase: 06-integration-testing
plan: "04"
type: fix
wave: 3
depends_on: []
gap_closure: true
files_modified:
  - tests/test_e2e_happy_path.py
autonomous: true

must_haves:
  truths:
    - "Bug fix: run_swarm_command now includes command in cmd list"
    - "Before: cmd = [..., '--cluster-id', cluster_id] + args (missing command)"
    - "After: cmd = [..., '--cluster-id', cluster_id, command] + args"
    - "E2E test test_cli_commands_work will now correctly invoke swarm CLI"
  artifacts:
    - path: "tests/test_e2e_happy_path.py"
      change: "Add `command` to cmd list in run_swarm_command function"
      line_range: [63, 66]
---

<objective>
Fix P6-01 CLI command missing bug in test_e2e_happy_path.py

Purpose: The run_swarm_command function builds the CLI command without the command argument
Output: tests/test_e2e_happy_path.py line 63-66 corrected
</objective>

<execution_context>
@/home/user/.claude/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@tests/test_e2e_happy_path.py (run_swarm_command function, line 50-77)
@.planning/phases/06-integration-testing/06-UAT.md (gap diagnosis)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix CLI command construction in run_swarm_command</name>
  <files>tests/test_e2e_happy_path.py</files>
  <action>
In `tests/test_e2e_happy_path.py`, fix the `run_swarm_command` function at line 63-66.

Change from:
```python
    cmd = [
        sys.executable, '-m', 'swarm.cli',
        '--cluster-id', cluster_id
    ] + args
```

To:
```python
    cmd = [
        sys.executable, '-m', 'swarm.cli',
        '--cluster-id', cluster_id,
        command
    ] + args
```

The `command` parameter (e.g., 'up', 'status', 'down') must be included in the cmd list before `args`.
  </action>
  <verify>
Verify with: `pytest tests/test_e2e_happy_path.py::test_cli_commands_work -v 2>&1 | head -20`
  </verify>
  <done>
run_swarm_command includes command in cmd list
  </done>
</task>

</tasks>

<verification>
After fix complete, verify:

1. **Syntax check:** `python -m py_compile tests/test_e2e_happy_path.py` passes
2. **Test collects:** `pytest tests/test_e2e_happy_path.py --collect-only` shows 1 test
3. **CLI structure:** The cmd list now includes: `['python', '-m', 'swarm.cli', '--cluster-id', X, 'up', '--workers', '2']`
</verification>

<success_criteria>
Gap P6-01 closed when:
- tests/test_e2e_happy_path.py line 63-66 includes `command` variable
- No syntax errors in test file
- Test can be collected and run
</success_criteria>

<output>
After completion, update .planning/phases/06-integration-testing/06-UAT.md to mark P6-01 as FIXED
</output>
