# Phase 26 - 集成与配置验证

**规划时间**: 2026-02-04
**预估工作量**: 1 任务点
**关联里程碑**: v1.86 - 主控自动救援闭环 + 状态汇总表

---

## 1. 功能概述

### 1.1 背景

Phase 24 和 25 已经实现了自动救援核心和状态汇总表。Phase 26 是验证型阶段，确认实现符合集成与配置的设计原则。

### 1.2 待验证需求

- **RESCUE-09**: 复用 PaneScanner 与 WaitDetector
- **RESCUE-10**: 复用 scripts/claude_auto_rescue.sh 的"安全确认"理念
- **RESCUE-11**: 统一走 status_broadcaster.py 输出状态日志
- **RESCUE-12**: 所有新增逻辑有清晰函数封装
- **RESCUE-13**: 冷却时间、扫描频率可配置（用环境变量）

---

## 2. 验证任务

### 任务 26-01: 集成与配置验证

**验证内容**:

1. **RESCUE-09 验证**: PaneScanner 与 WaitDetector 复用
   - 检查 master.py 中的类定义
   - 检查 Master.__init__ 中的初始化
   - 检查测试导入

2. **RESCUE-10 验证**: 安全确认理念复用
   - 检查 auto_rescuer.py 中的 DANGEROUS_PATTERNS
   - 检查 AUTO_ENTER_PATTERNS 和 MANUAL_CONFIRM_PATTERNS
   - 对比 shell 脚本的模式定义

3. **RESCUE-11 验证**: 统一日志输出
   - 检查 status_broadcaster.py 的使用
   - 检查所有模块是否通过 StatusBroadcaster 输出

4. **RESCUE-12 验证**: 函数封装
   - 检查 Master.run() 主循环
   - 确认无内联逻辑

5. **RESCUE-13 验证**: 环境变量配置
   - 检查 AI_SWARM_POLL_INTERVAL
   - 检查 AI_SWARM_AUTO_RESCUE_COOLING
   - 检查 AI_SWARM_AUTO_RESCUE_DRY_RUN

**验证命令**:
```bash
# RESCUE-09: 检查 PaneScanner 和 WaitDetector
grep -n "class PaneScanner\|class WaitDetector" swarm/master.py
grep -n "self.pane_scanner\|self.wait_detector" swarm/master.py

# RESCUE-10: 检查危险模式定义
grep -n "DANGEROUS_PATTERNS\|AUTO_ENTER_PATTERNS\|MANUAL_CONFIRM_PATTERNS" swarm/auto_rescuer.py

# RESCUE-11: 检查状态广播器使用
grep -n "StatusBroadcaster\|broadcast_" swarm/master.py swarm/auto_rescuer.py

# RESCUE-12: 检查主循环
grep -n "def run" swarm/master.py | head -3
sed -n '464,535p' swarm/master.py

# RESCUE-13: 检查环境变量
grep -n "AI_SWARM_" swarm/master.py swarm/auto_rescuer.py
```

**验收标准**:
- [ ] RESCUE-09: PaneScanner 和 WaitDetector 类存在且被使用
- [ ] RESCUE-10: Python 实现包含与 shell 脚本对应的模式定义
- [ ] RESCUE-11: 所有状态输出通过 status_broadcaster.py
- [ ] RESCUE-12: 主循环无内联逻辑，均已封装
- [ ] RESCUE-13: 支持环境变量配置

---

## 3. 验收标准

功能完整需满足:

- [ ] RESCUE-09: 复用现有 PaneScanner/WaitDetector，无重复代码
- [ ] RESCUE-10: 复用 claude_auto_rescue.sh 的安全确认理念
- [ ] RESCUE-11: 统一通过 status_broadcaster.py 输出日志
- [ ] RESCUE-12: 新增逻辑有清晰函数封装，主循环简洁
- [ ] RESCUE-13: 冷却时间、扫描频率可通过环境变量配置

---

## 4. 文件变更清单

| 文件 | 操作 | 说明 |
|------|------|------|
| `.planning/ROADMAP.md` | 修改 | 将 RESCUE-09~13 移至 Phase 26 Complete |
| `.planning/REQUIREMENTS.md` | 修改 | RESCUE-09~13 Status 改为 Complete |

---

## 5. 后续

验证完成后:
- 更新 ROADMAP.md 和 REQUIREMENTS.md
- v1.86 里程碑完成
