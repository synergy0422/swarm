# 功能验证：Phase 25 - 状态汇总表验证

**规划时间**: 2026-02-04
**预估工作量**: 2 任务点
**关联里程碑**: v1.86 - 主控自动救援闭环 + 状态汇总表

---

## 1. 功能概述

### 1.1 背景

Phase 24 执行时，状态汇总表功能已在 `swarm/master.py` 中实现。本计划用于验证该功能是否完整符合 ROADMAP.md 中 Phase 25 的要求。

### 1.2 待验证需求

- **RESCUE-05**: 每次扫描生成一张"窗口/状态/当前任务/备注"的简表
- **RESCUE-06**: 与文档中"指挥官汇报格式"对齐
- **RESCUE-07**: 能区分 ERROR / WAIT / DONE / RUNNING 状态
- **RESCUE-08**: 状态优先级：ERROR > WAIT > RUNNING > DONE/IDLE

---

## 2. 验证任务

### 任务 25-01: 代码审查

**验证内容**:

1. 检查 `_format_summary_table()` 方法是否存在
2. 检查输出格式是否为 `window | state | task_id | note`
3. 检查状态优先级逻辑是否实现
4. 检查是否区分 ERROR / WAIT / DONE / RUNNING

**验证命令**:
```bash
# 检查方法存在
grep -n "_format_summary_table\|PaneSummary\|STATE_PRIORITY" swarm/master.py

# 检查格式输出
grep -A 30 "def _format_summary_table" swarm/master.py

# 检查状态优先级
grep -n "STATE_PRIORITY\|ERROR\|WAIT\|RUNNING\|DONE\|IDLE" swarm/master.py | head -20
```

**验收标准**:
- [ ] `_format_summary_table()` 方法存在
- [ ] 输出格式包含: window, state, task_id, note
- [ ] STATE_PRIORITY 字典定义正确
- [ ] 能区分所有要求的状态

### 任务 25-02: 功能验证

**验证内容**:

1. 验证 PaneSummary 类结构正确
2. 验证 _output_status_summary() 调用链
3. 验证状态更新逻辑

**验证命令**:
```bash
# 导入测试
python3 -c "
from swarm.master import Master, PaneSummary
print('Master import OK')
print('PaneSummary import OK')

# 验证类结构
ps = PaneSummary('test')
print(f'PaneSummary attributes: {list(ps.__dict__.keys())}')
"

# 检查输出方法
grep -n "def _output_status_summary\|def _format_summary_table\|def _update_summary_from_workers" swarm/master.py
```

**验收标准**:
- [ ] Master 和 PaneSummary 可正常导入
- [ ] PaneSummary 包含 required 属性
- [ ] _output_status_summary() 方法存在
- [ ] _update_summary_from_workers() 存在

---

## 3. 验收标准

功能完整需满足:

- [ ] RESCUE-05: 汇总表格式 `window | state | task_id | note` 正确实现
- [ ] RESCUE-06: 格式与指挥官汇报格式对齐
- [ ] RESCUE-07: 能区分 ERROR / WAIT / DONE / RUNNING 状态
- [ ] RESCUE-08: 状态优先级 ERROR > WAIT > RUNNING > DONE/IDLE 正确

---

## 4. 文件变更清单

| 文件 | 操作 | 说明 |
|------|------|------|
| `.planning/ROADMAP.md` | 修改 | 将 RESCUE-05~08 移至 Phase 24 Complete |
| `.planning/REQUIREMENTS.md` | 修改 | RESCUE-05~08 Status 改为 Complete |

---

## 5. 后续

验证完成后:
- 更新 ROADMAP.md 和 REQUIREMENTS.md
- 继续 Phase 26: 集成与配置
